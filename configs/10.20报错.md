phoenix_backend   | ERROR:    Exception in ASGI application
phoenix_backend   | Traceback (most recent call last):
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2118, in _exec_insertmany_context                                                                           
phoenix_backend   |     dialect.do_execute(
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute                                                                                       
phoenix_backend   |     cursor.execute(statement, parameters)                                                                                                                                                    
phoenix_backend   | psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_coal_inventory_unique"                                                                                  
phoenix_backend   | DETAIL:  Key (company, coal_type, date)=(BeiHai, bituminous_coal, 2025-10-19) already exists.
phoenix_backend   |                                                                                                                                                                                              
phoenix_backend   |                                                                                                                                                                                              
phoenix_backend   | The above exception was the direct cause of the following exception:                                                                                                                         
phoenix_backend   | 
phoenix_backend   | Traceback (most recent call last):                                                                                                                                                           
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi                                                                             
phoenix_backend   |     result = await app(  # type: ignore[func-returns-value]                                                                                                                                  
phoenix_backend   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                  
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
phoenix_backend   |     return await self.app(scope, receive, send)                                                                                                                                              
phoenix_backend   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                              
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__                                                                                             
phoenix_backend   |     await super().__call__(scope, receive, send)                                                                                                                                             
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
phoenix_backend   |     await self.middleware_stack(scope, receive, send)                                                                                                                                        
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__                                                                                       
phoenix_backend   |     raise exc                                                                                                                                                                                
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__                                                                                       
phoenix_backend   |     await self.app(scope, receive, _send)
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__                                                                                          
phoenix_backend   |     await self.simple_response(scope, receive, send, request_headers=headers)                                                                                                                
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response                                                                                  
phoenix_backend   |     await self.app(scope, receive, send)
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__                                                                                    
phoenix_backend   |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                                                                                                                 
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app                                                                                    
phoenix_backend   |     raise exc                                                                                                                                                                                
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app                                                                                    
phoenix_backend   |     await app(scope, receive, sender)                                                                                                                                                        
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__                                                                                  
phoenix_backend   |     await self.app(scope, receive, send)                                                                                                                                                     
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
phoenix_backend   |     await self.middleware_stack(scope, receive, send)                                                                                                                                        
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app                                                                                                      
phoenix_backend   |     await route.handle(scope, receive, send)                                                                                                                                                 
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle                                                                                                   
phoenix_backend   |     await self.app(scope, receive, send)                                                                                                                                                     
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app                                                                                                        
phoenix_backend   |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)                                                                                                                   
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app                                                                                    
phoenix_backend   |     raise exc
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app                                                                                    
phoenix_backend   |     await app(scope, receive, sender)                                                                                                                                                        
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app                                                                                                        
phoenix_backend   |     response = await f(request)
phoenix_backend   |                ^^^^^^^^^^^^^^^^                                                                                                                                                              
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 389, in app                                                                                                        
phoenix_backend   |     raw_response = await run_endpoint_function(                                                                                                                                              
phoenix_backend   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                              
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 288, in run_endpoint_function
phoenix_backend   |     return await dependant.call(**values)                                                                                                                                                    
phoenix_backend   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                    
phoenix_backend   |   File "/app/backend/api/v1/daily_report_25_26.py", line 736, in submit_debug                                                                                                                
phoenix_backend   |     return await handle_coal_inventory_submission(payload)                                                                                                                                   
phoenix_backend   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                   
phoenix_backend   |   File "/app/backend/api/v1/daily_report_25_26.py", line 1026, in handle_coal_inventory_submission                                                                                           
phoenix_backend   |     inserted = _persist_coal_inventory(records)                                                                                                                                              
phoenix_backend   |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                              
phoenix_backend   |   File "/app/backend/api/v1/daily_report_25_26.py", line 1012, in _persist_coal_inventory
phoenix_backend   |     session.bulk_save_objects(models)                                                                                                                                                        
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4564, in bulk_save_objects                                                                                  
phoenix_backend   |     self._bulk_save_mappings(                                                                                                                                                                
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4741, in _bulk_save_mappings                                                                                
phoenix_backend   |     with util.safe_reraise():
phoenix_backend   |          ^^^^^^^^^^^^^^^^^^^                                                                                                                                                                 
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__                                                                                       
phoenix_backend   |     raise exc_value.with_traceback(exc_tb)                                                                                                                                                   
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4730, in _bulk_save_mappings
phoenix_backend   |     bulk_persistence._bulk_insert(                                                                                                                                                           
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/bulk_persistence.py", line 222, in _bulk_insert                                                                               
phoenix_backend   |     result = persistence._emit_insert_statements(                                                                                                                                            
phoenix_backend   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                            
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1048, in _emit_insert_statements
phoenix_backend   |     result = connection.execute(                                                                                                                                                             
phoenix_backend   |              ^^^^^^^^^^^^^^^^^^^                                                                                                                                                             
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute                                                                                            
phoenix_backend   |     return meth(
phoenix_backend   |            ^^^^^                                                                                                                                                                             
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection                                                                             
phoenix_backend   |     return connection._execute_clauseelement(                                                                                                                                                
phoenix_backend   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
phoenix_backend   |     ret = self._execute_context(                                                                                                                                                             
phoenix_backend   |           ^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                             
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1844, in _execute_context                                                                                   
phoenix_backend   |     return self._exec_insertmany_context(dialect, context)
phoenix_backend   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                   
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2126, in _exec_insertmany_context                                                                           
phoenix_backend   |     self._handle_dbapi_exception(
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception                                                                            
phoenix_backend   |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e                                                                                                                            
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2118, in _exec_insertmany_context                                                                           
phoenix_backend   |     dialect.do_execute(
phoenix_backend   |   File "/usr/local/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute                                                                                       
phoenix_backend   |     cursor.execute(statement, parameters)                                                                                                                                                    
phoenix_backend   | sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "idx_coal_inventory_unique"                                                  
phoenix_backend   | DETAIL:  Key (company, coal_type, date)=(BeiHai, bituminous_coal, 2025-10-19) already exists.                                                                                                
phoenix_backend   | 
phoenix_backend   | [SQL: INSERT INTO coal_inventory_data (company, company_cn, coal_type, coal_type_cn, storage_type, storage_type_cn, value, unit, date, operation_time) VALUES (%(company__0)s, %(company_cn__0)s, %(coal_type__0)s, %(coal_type_cn__0)s, %(storage_type__0)s, %( ... 10176 characters truncated ... e__53)s, %(storage_type_cn__53)s, %(value__53)s, %(unit__53)s, %(date__53)s, %(operation_time__53)s)]     
phoenix_backend   | [parameters: {'operation_time__0': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__0': Decimal('1'), 'storage_type_cn__0': '在途煤炭', 'date__0': datetime.date(2025, 10, 19), 'company__0': 'BeiHai', 'unit__0': '吨', 'company_cn__0': '北海热电厂', 'coal_type_cn__0': '烟煤', 'coal_type__0': 'bituminous_coal', 'storage_type__0': 'coal_in_transit', 'operation_time__1': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__1': Decimal('6'), 'storage_type_cn__1': '港口存煤', 'date__1': datetime.date(2025, 10, 19), 'company__1': 'BeiHai', 'unit__1': '吨', 'company_cn__1': '北海热电厂', 'coal_type_cn__1': '烟煤', 'coal_type__1': 'bituminous_coal', 'storage_type__1': 'coal_at_port', 'operation_time__2': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__2': Decimal('0'), 'storage_type_cn__2': '厂内存煤', 'date__2': datetime.date(2025, 10, 19), 'company__2': 'BeiHai', 'unit__2': '吨', 'company_cn__2': '北海热电厂', 'coal_type_cn__2': '烟煤', 'coal_type__2': 'bituminous_coal', 'storage_type__2': 'coal_at_plant', 'operation_time__3': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__3': Decimal('2'), 'storage_type_cn__3': '在途煤炭', 'date__3': datetime.date(2025, 10, 19), 'company__3': 'BeiHai', 'unit__3': '吨', 'company_cn__3': '北海热电厂', 'coal_type_cn__3': '褐煤', 'coal_type__3': 'lignite_coal', 'storage_type__3': 'coal_in_transit', 'operation_time__4': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__4': Decimal('7'), 'storage_type_cn__4': '港口存煤', 'date__4': datetime.date(2025, 10, 19), 'company__4': 'BeiHai', 'unit__4': '吨', 'company_cn__4': '北海热电厂', 'coal_type_cn__4': '褐煤', 'coal_type__4': 'lignite_coal', 'storage_type__4': 'coal_at_port' ... 440 parameters truncated ... 'operation_time__49': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__49': Decimal('0'), 'storage_type_cn__49': '港口存煤', 'date__49': datetime.date(2025, 10, 19), 'company__49': 'ZhuangHe', 'unit__49': '吨', 'company_cn__49': '庄河环海', 'coal_type_cn__49': '褐煤', 'coal_type__49': 'lignite_coal', 'storage_type__49': 'coal_at_port', 'operation_time__50': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__50': Decimal('0'), 'storage_type_cn__50': '厂内存煤', 'date__50': datetime.date(2025, 10, 19), 'company__50': 'ZhuangHe', 'unit__50': '吨', 'company_cn__50': '庄河环海', 'coal_type_cn__50': '褐煤', 'coal_type__50': 'lignite_coal', 'storage_type__50': 'coal_at_plant', 'operation_time__51': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__51': Decimal('0'), 'storage_type_cn__51': '在途煤炭', 'date__51': datetime.date(2025, 10, 19), 'company__51': 'ZhuangHe', 'unit__51': '吨', 'company_cn__51': '庄河环海', 'coal_type_cn__51': '印尼煤', 'coal_type__51': 'indonesia_coal', 'storage_type__51': 'coal_in_transit', 'operation_time__52': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__52': Decimal('0'), 'storage_type_cn__52': '港口存煤', 'date__52': datetime.date(2025, 10, 19), 'company__52': 'ZhuangHe', 'unit__52': '吨', 'company_cn__52': '庄河环海', 'coal_type_cn__52': '印尼煤', 'coal_type__52': 'indonesia_coal', 'storage_type__52': 'coal_at_port', 'operation_time__53': datetime.datetime(2025, 10, 20, 16, 34, 47, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800))), 'value__53': Decimal('0'), 'storage_type_cn__53': '厂内存煤', 'date__53': datetime.date(2025, 10, 19), 'company__53': 'ZhuangHe', 'unit__53': '吨', 'company_cn__53': '庄河 环海', 'coal_type_cn__53': '印尼煤', 'coal_type__53': 'indonesia_coal', 'storage_type__53': 'coal_at_plant'}]
phoenix_backend   | (Background on this error at: https://sqlalche.me/e/20/gkpj)