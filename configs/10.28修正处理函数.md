
• 我看到的变化点（仅阅读，不改动）
                                                                                                                                                                                               
  - 新增了第二个审批字典：GongRe_branches_detail_approval_Sheet（分中心明细），列头为“项目/中心/计量单位/…”，而非原来的“项目/计量单位/…”。行数据按中心展开（华乐/东港/…）。                    
  - 表达式增强：                                                                                                                                                                               
      - 常量别名点号仍沿用：c.售电单价、c.供暖收费面积、c.挂网面积 等。                                                                                                                        
      - 引用其它项目的“带参数取值”写法：如 value_biz_date(本月累计净投诉量)、value_peer_date(本月累计净投诉量)（昨天是无参函数，默认取“当前行项目”）。                                         
      - 单耗/强度指标：如 站内耗热量/c.供暖收费面积、外购电量*10000/c.供暖收费面积、耗水量/c.供暖收费面积。                                                                                    
      - 差异列的占位出现多种拼写（含 sum_month_diff_rate()、sum_ytd_diff_rate() 和不带括号的变体），但位置仍在“月差异/供暖期差异”列。                                                          
  - 项目字典扩展：                                                                                                                                                                             
      - 公司审批表（BeiHai）沿用昨天结构；                                                                                                                                                     
      - 分中心审批表新增一套针对中心维度的 item 键（如 consumption_station_heat、amount_daily_*_complaints、rate_*_per_10k_m2 等）以及“单位字典”（中心英文码→中文）。                          
                                                                                                                                                                                               
  与当前后端求值器的差距                                                                                                                                                                       
                                                                                                                                                                                               
  - 列结构假设不匹配：求值器把列0/1视为“项目/计量单位”，对“项目/中心/计量单位”的表结构目前不识别中心列。                                                                                       
  - 维度假设不匹配：当前只按 company 维度取数（sum_basic_data / daily_basic_data / constant_data）。分中心场景需要以“中心”为 company 参与查询（或在查询时切换 company）。                      
  - “带参数”取值未支持：value_biz_date(xxx) 目前是无参函数，会抛 TypeError。理论上等价于 I("xxx") 在相应帧上取值。                                                                             
  - 常量的中心维度：现实现仅按 company 过滤常量；若常量按中心入库，需要优先以 center 命中，fallback 到公司。                                                                                   
  - 差异列解析：虽然最终是按列头计算，但代码只把 date_diff_rate/month_diff_rate/ytd_diff_rate 标记为延迟计算；像 sum_month_diff_rate()/无括号的变体，eval_cell 会先尝试求值并记录错误，再被差异    逻辑覆盖，存在不必要的错误轨迹噪音。                                                                                                                                                       
                                                                                                                                                                                               
  建议的改造方向（供你确认后再动手）                                                                                                                                                           
                                                                                                                                                                                               
  - 列/维度支持                                                                                                                                                                                
      - 识别“项目/中心/计量单位”列结构：将中心中文名（第二列）通过 spec 的“单位字典”映射为 center 英文码，并在本行求值时把 company 动态切换为该 center 码。                                    
      - 缓存策略：可对一个 spec 执行期间维护“按 company 的 metrics/consts 缓存字典”，不同中心共享同一连接、按需加载。                                                                          
  - 带参数取值                                                                                                                                                                                 
      - 扩展无参函数为可选参数形式：value_biz_date(name?)/value_peer_date(name?)/sum_month_biz(name?) 等；当提供参数时，语义等价于 I("name") 在对应帧上取值；未提供参数时仍取“当前行项目”。    
  - 常量维度优先级                                                                                                                                                                             
      - 差异列表达式白名单扩展：把 sum_month_diff_rate/sum_ytd_diff_rate（带/不带括号）一并识别为“延迟计算”，避免误报错误。
      - 数字/别名/项目名替换规则可复用，无需调整。
  - 可配置供暖期窗口
      - 若你计划让 biz/peer 的供暖期起点随年份变动，考虑把 _fetch_metrics_dynamic_by_date 中的 2025-10-01/2024-10-01 参数化（context 或配置），以便未来跨年无需改代码。

  - 分中心明细聚合是否一律视“中心”为 company 维度来查 sum_basic_data/daily_basic_data 与 constant_data？（即 DB 中分中心数据与常量均以 center 英文码作为 company 存储）
  - value_biz_date(本月累计净投诉量) 的预期语义就是“按该列帧从指标缓存中取‘本月累计净投诉量’的值”，对吗？

  得到你的确认后，我再基于以上差距清单，对 runtime_expression.py 做最小影响的增量改造，并附上变更点与测试要点。


——————————————————————————————————————————————————————————————————————

我们一项项解决，你提到的这些，大多是本次我打算增加的语法规则。"value_biz_date()"这类标识正常是不带参数的，表示该company的该item的时间口径为"biz_date"的数值；而带有参数，如value_biz_date(xxx)，则表示该company的item=xxx（也需要先反向查询一次字典，转换为英文的item）的biz_date时间口径的数值。

=====
接下来是关于第二个字典的特性，你提到使用"中心"字段作为区分每个company的标志，其实是理解了我的意思，就是在这一个字段中，读到什么company（凡是中文都需要经过字典反向转换为英文，即正确的company名），就去找这个company的相应item的相应时间口径值。但是，为什么是"中心"字段也不是别的，是由"查询数据源"中的"column_index":1定义的，因为列名是"列名": ["项目","中心", "计量单位", "(本期日)", "(同期日)", "日差异","(本期月)","(同期月)","月差异","(本供暖期)","(同供暖期)","供暖期差异"]，所以，1就表示第二项（从0开始）即"中心"。