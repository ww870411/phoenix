刚才，我们一起构建了两张物化视图
首先是sum_basic_data，它是根据数据库表daily_basic_sheet建立的，按company>按item，然后分为8个时间口径对value进行累计，这8个时间口径分别为biz_date（即为当前时间的昨日），同期日（biz_date的去年同期日），以biz_date为最后一天的近7日累计，以同期日为最后一天的近7日累计，biz_date所在月份的累计，同期日所在月份的累计，从2025年10月1日至biz_date的累计，从2024年10月1日至同期日的累计。
这张视图的作用，是对基本指标表中各单位每日填报数据指标进行的各口径累计计算，用于后续的累计值展示以及进一步计算。
另一张物化视图是sum_gongre_branches_detail_data，它是根据数据库表gongre_branches_detail_data建立的。按center>item，然后分为8个时间口径对value进行累计，各口径含义同上。
这张视图的意义与前一张相似，区别在于，前一张是根据company，也就是各单位来分类聚合的，而这一张是根据center也就是各中心，来分类聚合的，所谓各中心，就是某一个叫做GongRe的单位，其内部又分为10个中心，用户认为有必要对其进行专门的统计，因此才出现了这张表。
以上两张物化视图实际上都没有新增任何指标，只是做了不同口径的累计。
现在，我需要在它们两个的基础上，分别构建新的物化视图，用于添加原来的基本指标未包含的计算指标，我将它们称为“二级物化视图”。

二级物化视图中的第一张是calc_sum_basic_data，它是物化视图sum_basic_data的后代视图，它基于物化视图sum_basic_data以及数据库表constant_data，添加了一些计算指标，以充实指标库，是sum_basic_data及constant_data的数据共同计算出来，其中包含一些使用计算出来的指标再次计算的指标。
按每个company，我将其计算指标的item名字以及计算公式逐个列出，等号右侧的公式中，直接写item名字的就是代表物化视图sum_basic_data的同一company的对应item；写c.xxx的，就是代表数据库表constant_data中同一company的对应item。
如果某个计算指标item在其公式中使用了其他计算指标item，那么代表它依赖等号右侧的计算指标item的计算值。也就是说，会有先后顺序的问题。
当然，它也有8个时间口径，每个时间口径的计算指标item值，也都是按照该时间口径的相应的item的value计算的。

计算公式
company:BeiHai，XiangHai
eco_direct_income=eco_power_supply_income+eco_heat_supply_income
eco_power_supply_income=amount_power_sales*c.price_power_sales
eco_heat_supply_income=（amount_heat_supply*c.price_heat_sales）/10000
eco_coal_cost=（consumption_amount_raw_coal*c.price_raw_coal）/10000
eco_natural_gas_cost=（consumption_natural_gas*c.price_natural_gas）/10000
eco_purchased_power_cost=（consumption_plant_purchased_power*c.price_purchased_power）/10000
eco_purchased_water_cost=（consumption_plant_water*c.price_purchased_water）/10000
eco_measurable_auxiliary_materials=(consumption_acid*c.price_acid+consumption_alkali*c.price_clkali+consumption_oil*c.price_oil+consumption_ammonia_water*c.price_n_ammonia_water+consumption_limestone_powder*c.price_limestone_powder)/10000
eco_marginal_profit=eco_direct_income-eco_coal_cost-eco_natural_gas_cost-eco_purchased_power_cost-eco_purchased_water_cost-eco_measurable_auxiliary_materials
eco_comparable_marginal_profit=eco_direct_income-eco_natural_gas_cost-eco_purchased_power_cost-eco_purchased_water_cost-eco_measurable_auxiliary_materials-(consumption_std_coal*c.price_std_coal_comparable)/10000
rate_overall_efficiency=(amount_heat_supply+amount_power_sales*36)/(29.308*consumption_std_coal)

company:GongRe
amount_heat_lose=amount_network_interface_heat_supply-consumption_station_heat
eco_direct_income=eco_heating_income+eco_hot_water_income+eco_steam_income
eco_heating_income=(c.eco_season_heating_income)/157
eco_purchased_heat_cost=(amount_network_interface_heat_supply*c.price_purchased_heat)/10000
eco_purchased_power_cost=consumption_station_purchased_power*c.price_purchased_power
eco_purchased_water_cost=(consumption_water*c.price_purchased_water)/10000
eco_marginal_profit=eco_direct_income-eco_purchased_heat_cost-eco_purchased_power_cost-eco_purchased_water_cost
eco_comparable_marginal_profit=eco_direct_income-eco_purchased_heat_cost-eco_purchased_power_cost-eco_purchased_water_cost
amount_daily_net_complaints_per_10k_m2=amount_daily_net_complaints/amount_whole_heating_area
rate_coal_per_10k_m2=consumption_station_heat/amount_heating_fee_area
rate_power_per_10k_m2=consumption_station_purchased_power/amount_heating_fee_area
rate_water_per_10k_m2=consumption_water/amount_heating_fee_area

company:JinZhou,BeiFang,JinPu,ZhuangHe,YanJiuYuan
consumption_station_heat=amount_heat_supply
eco_direct_income=eco_power_income+eco_heating_income+eco_hot_water_income
eco_power_income=amount_power_sales*c.price_power_sales
eco_heating_income=c.eco_season_heating_income/157
eco_hot_water_income=amount_hot_water_sales*c.price_hot_water/10000
eco_coal_cost=consumption_amount_raw_coal*c.price_raw_coal/10000
eco_purchased_power_cost=consumption_purchased_power*c.price_purchased_power/10000
eco_purchased_water_cost=consumption_water*c.price_purchased_water/10000
eco_heat_cost=consumption_purchased_heat*c.price_purchased_heat/10000
eco_measurable_auxiliary_materials=(consumption_acid*c.price_acid+consumption_alkali*c.price_clkali+consumption_oil*c.price_oil+consumption_ammonia_water*c.price_n_ammonia_water+consumption_limestone*c.price_limestone+consumption_limestone_powder*c.price_limestone_powder+consumption_magnesium_oxide*c.price_magnesium_oxide+consumption_denitration_agent*c.price_denitration_agent)/10000
eco_marginal_profit=eco_direct_income-eco_coal_cost-eco_purchased_power_cost-eco_purchased_water_cost-eco_heat_cost-eco_measurable_auxiliary_materials
eco_comparable_marginal_profit=eco_direct_income-eco_purchased_power_cost-eco_purchased_water_cost-eco_heat_cost-eco_measurable_auxiliary_materials-consumption_std_coal*c.price_std_coal_comparable/10000
rate_overall_efficiency=(amount_heat_supply+amount_power_sales*36-consumption_purchased_heat)/(29.308*consumption_std_coal)
amount_daily_net_complaints_per_10k_m2=amount_daily_net_complaints/amount_whole_heating_area
rate_std_coal_per_10k_m2=consumption_std_coal/amount_heating_fee_area
rate_coal_per_10k_m2=consumption_station_heat/amount_heating_fee_area
rate_power_per_10k_m2=consumption_purchased_power/amount_heating_fee_area
rate_water_per_10k_m2=consumption_water/amount_heating_fee_area


另一张新增的二级物化视图，命名为calc_sum_gongre_branches_detail_data，它是物化视图sum_gongre_branches_detail_data的后代视图，同样是在原来的物化视图sum_gongre_branches_detail_data基础上新增了计算指标，以充实指标库，它基于物化视图gongre_branches_detail_data，数据库表constant_data以及物化视图sum_basic_data的数据构建（没错，并不是完全的单线引用了，而是引用了非这条线的其它视图）。这些新增的计算指标，是按center分类的，每个center的每个计算指标item，我都写了公式，等号右侧的item名字，无前缀的表示本company的item，有前缀如c.xxx的，表示constant_data数据库表中相同company的item，有前缀如sd.GongRe.xxx的，表示物化视图sum_gongre_branches_detail_data中的company为GongRe的item。当然，也有8个时间口径，每个时间口径下的计算指标item都是用本时间口径下的相应item计算。
如果某个计算指标item在其公式中使用了其他计算指标item，那么代表它依赖等号右侧的计算指标item的计算值。

计算公式：
amount_daily_net_complaints_per_10k_m2=amount_daily_net_complaints/c.amount_whole_heating_area
eco_direct_income=c.eco_season_heating_income*rate_sharing_ratio
eco_station_purchased_heat_cost=sd.GongRe.consumption_station_heat*c.price_purchased_heat*rate_sharing_ratio
eco_heat_lose=sd.GongRe.amount_heat_lose*c.price_purchased_heat*rate_sharing_ratio
eco_purchased_water_cost=consumption_water*c.price_purchased_water
eco_purchased_power_cost=consumption_station_purchased_power*c.price_purchased_power
eco_marginal_profit=eco_direct_income-eco_station_purchased_heat_cost-eco_heat_lose-eco_purchased_water_cost-eco_purchased_power_cost


上述两个二级物化视图，其使用constant_data数据库表的数据时，8个时间口径中的
biz_date（即为当前时间的昨日），以biz_date为最后一天的近7日累计，biz_date所在月份的累计，从2025年10月1日至biz_date的累计均使用25-26period的value
同期日（biz_date的去年同期日），以同期日为最后一天的近7日累计，同期日所在月份的累计，从2024年10月1日至同期日的累计均使用24-25period的value

上述两个二级物化视图，字段与其祖先视图一致，指标方面，除了新增的计算指标item之外，还要有对应的祖先视图中的item，原样搬过来就好。

参考文件：
1.数据库表配置文件：D:\编程项目\phoenix\backend\sql\create_tables.sql
2.数据库表对应的页面模板：D:\编程项目\phoenix\backend_data\数据结构_基本指标表.json（内含指标字典，包括计算指标），D:\编程项目\phoenix\backend_data\数据结构_常量指标表.json。
3.两个祖先视图配置文件：D:\编程项目\phoenix\backend\sql\create_view.sql